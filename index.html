<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Future Architect | Rators Club</title>
    
    <link rel="icon" href="https://drive.google.com/thumbnail?id=1bOFY9XiVAv-WRQnVHXSnL5FHVEoK3UAp&sz=w128" type="image/png">
    
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,600;0,700;1,400&family=Nunito+Sans:wght@300;400;600;700;800&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

    <style>
        /* ========================================
           DESIGN SYSTEM: TITAN HIGH CONTRAST
           ======================================== */
        :root {
            /* --- LIGHT THEME (Default) --- */
            --page-bg: #f1f5f9;       /* Slate 100 - Fondo General */
            --card-bg: #ffffff;       /* White - Tarjetas */
            --element-bg: #f8fafc;    /* Slate 50 - Inputs/Bloques */
            
            --text-main: #0f172a;     /* Slate 900 - Títulos */
            --text-body: #334155;     /* Slate 700 - Párrafos */
            --text-muted: #64748b;    /* Slate 500 - Subtítulos */
            
            --border: #e2e8f0;        /* Slate 200 */
            --sidebar-bg: #ffffff;
            
            /* Functional Colors */
            --brand: #0891b2;         /* Cyan 600 - Main */
            --will: #06b6d4;          /* Cyan 500 */
            --wont: #f43f5e;          /* Rose 500 */
            --accent: #8b5cf6;        /* Violet 500 */
            --success: #10b981;       /* Emerald 500 */
            
            /* UI States */
            --will-light: #ecfeff;    /* Cyan 50 */
            --wont-light: #fff1f2;    /* Rose 50 */
            --hover-shadow: 0 10px 30px -10px rgba(0,0,0,0.15);
        }

        /* --- DARK THEME (Contrast Fixed) --- */
        body.dark-mode {
            --page-bg: #020617;       /* Slate 950 */
            --card-bg: #1e293b;       /* Slate 800 */
            --element-bg: #334155;    /* Slate 700 */
            
            --text-main: #f8fafc;     /* Slate 50 - Brillante */
            --text-body: #cbd5e1;     /* Slate 300 - Legible */
            --text-muted: #94a3b8;    /* Slate 400 */
            
            --border: #475569;        /* Slate 600 */
            --sidebar-bg: #0f172a;
            
            /* Functional Shift */
            --brand: #22d3ee;         /* Cyan 400 (Más brillante) */
            --will: #67e8f9;          /* Cyan 300 */
            --wont: #fb7185;          /* Rose 400 */
            
            /* UI States */
            --will-light: rgba(6, 182, 212, 0.1); 
            --wont-light: rgba(244, 63, 94, 0.1);
        }

        /* --- GLOBAL RESET --- */
        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: 'Nunito Sans', sans-serif; 
            background: var(--page-bg); 
            color: var(--text-body); 
            line-height: 1.6;
            overflow-x: hidden; /* Evita scroll horizontal */
            transition: background 0.3s ease, color 0.3s ease;
        }

        h1, h2, h3, h4 { font-family: 'Lora', serif; font-weight: 700; color: var(--text-main); line-height: 1.2; }
        .mono { font-family: 'JetBrains Mono', monospace; }

        /* --- LAYOUT ARCHITECTURE (Fixed Overlap) --- */
        .app-layout {
            display: grid;
            grid-template-columns: 280px 1fr; /* Sidebar fija | Contenido */
            min-height: 100vh;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border);
            height: 100vh;
            position: sticky;
            top: 0;
            overflow-y: auto;
            padding: 2rem 1.5rem;
            display: flex;
            flex-direction: column;
            z-index: 50;
        }

        /* --- MAIN CONTENT --- */
        .main-content {
            padding: 2rem 3rem;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        /* --- HEADER (Mobile Only mainly) --- */
        .mobile-header {
            display: none; /* Oculto en PC */
            position: fixed; top: 0; left: 0; width: 100%; height: 70px;
            background: var(--card-bg); border-bottom: 1px solid var(--border);
            z-index: 100; align-items: center; justify-content: space-between; padding: 0 1.5rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        /* --- RESPONSIVE LOGIC (Tablet/Mobile) --- */
        @media (max-width: 1024px) {
            .app-layout { display: block; } /* Romper el grid */
            .sidebar {
                position: fixed; left: 0; top: 70px; height: calc(100vh - 70px);
                transform: translateX(-100%); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                box-shadow: 10px 0 30px rgba(0,0,0,0.2);
            }
            .sidebar.open { transform: translateX(0); }
            .mobile-header { display: flex; }
            .main-content { padding: 90px 1.5rem 3rem; width: 100%; }
        }

        /* --- NAVIGATION ELEMENTS --- */
        .brand-box { display: flex; align-items: center; gap: 12px; margin-bottom: 2.5rem; color: var(--text-main); font-weight: 800; font-size: 1.2rem; }
        .brand-box img { width: 40px; height: 40px; border-radius: 10px; }

        .nav-label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1.5px; color: var(--text-muted); font-weight: 800; margin: 1.5rem 0 0.8rem 10px; }
        .nav-item {
            display: flex; align-items: center; gap: 12px; padding: 12px 16px;
            border-radius: 12px; color: var(--text-muted); font-weight: 600; font-size: 0.95rem;
            cursor: pointer; transition: 0.2s; margin-bottom: 4px;
        }
        .nav-item:hover { background: var(--element-bg); color: var(--text-main); }
        .nav-item.active { background: var(--brand); color: #ffffff; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .nav-item i { width: 24px; text-align: center; }

        /* --- CARDS & CONTENT --- */
        .section { display: none; animation: slideUp 0.5s ease; }
        .section.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .card {
            background: var(--card-bg); border: 1px solid var(--border); border-radius: 24px;
            padding: 3rem; margin-bottom: 2.5rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.02);
            position: relative; overflow: hidden;
        }

        .badge { display: inline-block; padding: 6px 14px; border-radius: 30px; font-size: 0.75rem; font-weight: 800; text-transform: uppercase; margin-bottom: 1.5rem; border: 1px solid; }
        .badge.cyan { background: var(--will-light); color: var(--will); border-color: var(--will); }
        .badge.rose { background: var(--wont-light); color: var(--wont); border-color: var(--wont); }

        /* --- INTERACTIVE GRID (Robot Rules) --- */
        .grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 2rem 0; }
        
        .interactive-box {
            padding: 2rem; border-radius: 20px; background: var(--element-bg);
            border: 2px solid transparent; cursor: pointer; transition: 0.3s; text-align: center;
        }
        .interactive-box:hover { transform: translateY(-5px); border-color: var(--border); box-shadow: var(--hover-shadow); }
        
        .box-will:hover { border-color: var(--will); background: var(--will-light); }
        .box-wont:hover { border-color: var(--wont); background: var(--wont-light); }

        .icon-lg { font-size: 3rem; margin-bottom: 1rem; display: block; }

        /* --- FORMULA BUILDER --- */
        .formula-box {
            background: var(--element-bg); border: 1px solid var(--border); border-radius: 16px; padding: 1.5rem;
            display: flex; flex-wrap: wrap; gap: 10px; align-items: center; justify-content: center;
            margin: 1.5rem 0; font-family: 'JetBrains Mono';
        }
        .block {
            padding: 10px 18px; border-radius: 10px; font-weight: 700; font-size: 0.9rem;
            background: var(--card-bg); border: 1px solid var(--border); color: var(--text-main);
            box-shadow: 0 2px 0 rgba(0,0,0,0.05);
        }
        .block.hl-will { background: var(--will); color: white; border-color: var(--will); }
        .block.hl-wont { background: var(--wont); color: white; border-color: var(--wont); }
        .block.base { border-style: dashed; color: var(--text-muted); }

        /* --- TABLES & AUDIO --- */
        .table-wrap { overflow-x: auto; margin-top: 1.5rem; border-radius: 12px; border: 1px solid var(--border); }
        .data-table { width: 100%; border-collapse: collapse; min-width: 500px; background: var(--card-bg); }
        .data-table th { text-align: left; padding: 18px; background: var(--element-bg); color: var(--text-muted); font-size: 0.8rem; text-transform: uppercase; font-weight: 800; border-bottom: 1px solid var(--border); }
        .data-table td { padding: 18px; border-bottom: 1px solid var(--border); color: var(--text-main); }
        .data-table tr:last-child td { border-bottom: none; }

        .btn-audio {
            width: 42px; height: 42px; border-radius: 50%; border: 2px solid var(--border);
            background: var(--card-bg); color: var(--text-main); cursor: pointer;
            display: inline-flex; align-items: center; justify-content: center; transition: 0.2s;
        }
        .btn-audio:hover { background: var(--text-main); color: var(--card-bg); transform: scale(1.1); }

        /* --- WORKSHOP & INPUTS --- */
        .workshop-area {
            background: var(--element-bg); border: 2px dashed var(--border); border-radius: 20px;
            padding: 2rem; text-align: center; margin-top: 2rem;
        }
        .slot-zone { 
            display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; min-height: 70px; 
            margin-bottom: 2rem; padding: 15px; background: var(--card-bg); border-radius: 12px; border: 1px solid var(--border);
        }
        .chip {
            padding: 10px 20px; background: var(--card-bg); border: 2px solid var(--border);
            border-radius: 10px; color: var(--text-main); font-weight: 700; cursor: pointer;
            box-shadow: 0 4px 0 rgba(0,0,0,0.05); user-select: none; transition: 0.1s; font-family: 'JetBrains Mono';
        }
        .chip:hover { border-color: var(--brand); color: var(--brand); transform: translateY(-2px); }
        .chip:active { transform: translateY(2px); box-shadow: none; }

        /* Fixed Input for Dark Mode */
        .input-lg {
            width: 100%; padding: 18px; border-radius: 12px; border: 2px solid var(--border);
            background: var(--card-bg); color: var(--text-main); font-family: 'JetBrains Mono';
            font-size: 1.3rem; text-align: center; margin: 20px 0; outline: none; transition: 0.3s;
        }
        .input-lg:focus { border-color: var(--brand); box-shadow: 0 0 0 4px var(--will-light); }

        /* --- BUTTONS --- */
        .btn-xl {
            width: 100%; padding: 20px; border-radius: 16px; border: none; font-size: 1.1rem;
            font-weight: 700; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 12px;
            background: var(--text-main); color: var(--page-bg); margin-top: 2rem;
        }
        .btn-xl:hover { transform: translateY(-3px); box-shadow: var(--hover-shadow); }
        
        .btn-outline { background: transparent; border: 2px solid var(--border); color: var(--text-main); }
        .btn-outline:hover { background: var(--element-bg); border-color: var(--text-main); }

        /* --- FEEDBACK --- */
        .feedback { display: none; padding: 18px; border-radius: 12px; margin-top: 20px; font-weight: 700; text-align: center; }
        .feedback.success { background: #dcfce7; color: #14532d; border: 1px solid #86efac; }
        .feedback.error { background: #fee2e2; color: #7f1d1d; border: 1px solid #fca5a5; }

        /* --- FOOTER --- */
        .footer-ribbon {
            background: var(--footer-bg); color: var(--footer-text);
            padding: 4rem 2rem 2rem; border-top: 1px solid rgba(255,255,255,0.1); margin-top: auto;
        }
        .footer-grid {
            max-width: 1100px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 3rem;
        }
        .footer-col h5 { color: white; margin-bottom: 1rem; }
        .footer-col p { font-size: 0.9rem; opacity: 0.8; }
        .legal {
            max-width: 1100px; margin: 4rem auto 0; padding-top: 2rem; border-top: 1px solid rgba(255,255,255,0.1);
            text-align: center; font-size: 0.75rem; font-family: 'JetBrains Mono'; letter-spacing: 1px; opacity: 0.5;
        }

    </style>
</head>
<body onload="initSystem()">

<div class="mobile-header">
    <div class="brand-box" style="margin:0;">
        <img src="https://drive.google.com/thumbnail?id=1bOFY9XiVAv-WRQnVHXSnL5FHVEoK3UAp&sz=w128" alt="Logo">
        Future Titan
    </div>
    <div onclick="toggleSidebar()" style="font-size:1.5rem; cursor:pointer;"><i class="fas fa-bars"></i></div>
</div>

<div class="app-layout">
    
    <nav class="sidebar" id="sidebar">
        <div class="brand-box">
            <img src="https://drive.google.com/thumbnail?id=1bOFY9XiVAv-WRQnVHXSnL5FHVEoK3UAp&sz=w128" alt="Logo">
            Rators Club
        </div>

        <div class="nav-label">Theory</div>
        <div class="nav-item active" onclick="nav('intro', this)"><i class="fas fa-rocket"></i> Intro & Logic</div>
        <div class="nav-item" onclick="nav('structure', this)"><i class="fas fa-robot"></i> The Robot Rule</div>
        <div class="nav-item" onclick="nav('usage', this)"><i class="fas fa-th-large"></i> The 4 Pillars</div>

        <div class="nav-label">Mechanics</div>
        <div class="nav-item" onclick="nav('contractions', this)"><i class="fas fa-compress-arrows-alt"></i> Contractions</div>
        <div class="nav-item" onclick="nav('negative', this)"><i class="fas fa-ban"></i> Won't vs Want</div>
        <div class="nav-item" onclick="nav('questions', this)"><i class="fas fa-question-circle"></i> Questions</div>

        <div class="nav-label">Practice</div>
        <div class="nav-item" onclick="nav('workshop', this)"><i class="fas fa-hammer"></i> Structure Builder</div>
        <div class="nav-item" onclick="nav('dictation', this)"><i class="fas fa-microphone-alt"></i> Dictation Mode</div>
        <div class="nav-item" onclick="nav('quiz', this)"><i class="fas fa-trophy"></i> Certification</div>

        <div class="nav-item" onclick="toggleTheme()" style="margin-top:2rem; justify-content:center; background:var(--element-bg);">
            <i class="fas fa-moon"></i> Toggle Theme
        </div>
    </nav>

    <main class="main-content">

        <section id="sec-intro" class="section active">
            <div class="card">
                <span class="badge cyan">Unit 02</span>
                <h1>The Instant <span>Future</span></h1>
                <p>El "Will" no es para planes detallados (eso es 'Going to'). El "Will" es para el futuro que nace <b>en este instante</b>: decisiones rápidas, promesas y predicciones del destino.</p>
                
                <div class="grid-2">
                    <div class="interactive-box box-will" onclick="nav('structure')">
                        <i class="fas fa-robot icon-lg" style="color:var(--will);"></i>
                        <h3>The Robot Rule</h3>
                        <p>El auxiliar <b>Will</b> es invariable. Trata a todos los sujetos igual. Nunca cambia.</p>
                    </div>
                    <div class="interactive-box box-will" onclick="nav('usage')">
                        <i class="fas fa-bolt icon-lg" style="color:var(--brand);"></i>
                        <h3>Spontaneous</h3>
                        <p>No lo pensaste ayer. Lo decidiste ahora mismo. Es una reacción al presente.</p>
                    </div>
                </div>

                <button class="btn-xl" onclick="nav('structure')">Entender la Estructura <i class="fas fa-arrow-right"></i></button>
            </div>
        </section>

        <section id="sec-structure" class="section">
            <div class="card">
                <span class="badge cyan">Logic</span>
                <h2>The <span style="color:var(--will);">Robot</span> Rule</h2>
                <p>Olvídate de la "S" para tercera persona. Olvídate del "To". Después de <b>Will</b>, el verbo siempre va en su forma <b>BASE</b>.</p>

                <div class="formula-box">
                    <div class="block">Subject</div> <i class="fas fa-plus"></i>
                    <div class="block hl-will">WILL</div> <i class="fas fa-plus"></i>
                    <div class="block base">Base Verb</div>
                </div>

                <div class="table-wrap">
                    <table class="data-table">
                        <tr><th>Listen</th><th>Sentence</th><th>Note</th></tr>
                        <tr>
                            <td><button class="btn-audio" onclick="speak('She will call you')"><i class="fas fa-volume-up"></i></button></td>
                            <td class="mono">She <b>will</b> call you.</td>
                            <td>No 'calls'</td>
                        </tr>
                        <tr>
                            <td><button class="btn-audio" onclick="speak('We will be there')"><i class="fas fa-volume-up"></i></button></td>
                            <td class="mono">We <b>will</b> be there.</td>
                            <td>'Be' is base</td>
                        </tr>
                    </table>
                </div>

                <button class="btn-xl" style="background:var(--brand);" onclick="nav('usage')">Ver los 4 Pilares <i class="fas fa-th-large"></i></button>
            </div>
        </section>

        <section id="sec-usage" class="section">
            <div class="card">
                <h2>The 4 Pillars of <span style="color:var(--will);">Will</span></h2>
                <div class="grid-2">
                    <div class="interactive-box" onclick="speak('I will help you.')">
                        <i class="fas fa-hand-holding-heart icon-lg" style="color:var(--will);"></i>
                        <h4>Offer / Ayuda</h4>
                        <p class="mono">"I'll help you with that."</p>
                    </div>
                    <div class="interactive-box" onclick="speak('I will love you forever.')">
                        <i class="fas fa-ring icon-lg" style="color:var(--will);"></i>
                        <h4>Promise</h4>
                        <p class="mono">"I will love you forever."</p>
                    </div>
                    <div class="interactive-box" onclick="speak('It will rain tomorrow.')">
                        <i class="fas fa-crystal-ball icon-lg" style="color:var(--will);"></i>
                        <h4>Prediction</h4>
                        <p class="mono">"It will rain tomorrow."</p>
                    </div>
                    <div class="interactive-box" onclick="speak('I will open the door.')">
                        <i class="fas fa-door-open icon-lg" style="color:var(--will);"></i>
                        <h4>Decision</h4>
                        <p class="mono">"I'll get the door."</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="sec-contractions" class="section">
            <div class="card">
                <h2>The <span style="color:var(--text-muted);">'ll</span> Sound</h2>
                <p>Casi nadie dice "I will". Usan la "L oscura" (/ɫ/).</p>
                
                <div class="grid-2">
                    <div class="interactive-box" onclick="speak('I\'ll see you later')">
                        <h3>I'll</h3>
                        <p class="mono">/aɪl/</p>
                        <small>Suena como "Ail"</small>
                    </div>
                    <div class="interactive-box" onclick="speak('You\'ll love it')">
                        <h3>You'll</h3>
                        <p class="mono">/juːl/</p>
                        <small>Suena como "Yul"</small>
                    </div>
                    <div class="interactive-box" onclick="speak('It\'ll be fine')">
                        <h3>It'll</h3>
                        <p class="mono">/ˈɪtəl/</p>
                        <small>Suena como "Í-tol"</small>
                    </div>
                </div>
                
                <button class="btn-xl" style="background:var(--wont);" onclick="nav('negative')">Alerta: Won't vs Want <i class="fas fa-ban"></i></button>
            </div>
        </section>

        <section id="sec-negative" class="section">
            <div class="card" style="border-top:5px solid var(--wont);">
                <h2 style="color:var(--wont);">Won't vs. Want</h2>
                <p>La pronunciación más confusa del inglés. Haz clic para entrenar tu oído.</p>
                
                <div class="grid-2">
                    <div class="interactive-box box-wont" onclick="speak('I won\'t go.')">
                        <h3 style="color:var(--wont);">Won't</h3>
                        <p>No lo haré.</p>
                        <p class="mono" style="font-size:1.2rem;">/woʊnt/</p>
                        <small>Sonido OU (como en 'Go').</small>
                    </div>
                    <div class="interactive-box" onclick="speak('I want to go.')">
                        <h3>Want</h3>
                        <p>Querer.</p>
                        <p class="mono" style="font-size:1.2rem;">/wɑːnt/</p>
                        <small>Sonido A abierta.</small>
                    </div>
                </div>
                
                <button class="btn-xl" onclick="nav('questions')">Ver Preguntas</button>
            </div>
        </section>

        <section id="sec-questions" class="section">
            <div class="card">
                <h2>Questions</h2>
                <div class="formula-box">
                    <div class="block hl-will">WILL</div> <i class="fas fa-plus"></i>
                    <div class="block">Subject</div> <i class="fas fa-plus"></i>
                    <div class="block base">Base Verb ?</div>
                </div>
                <div class="table-wrap">
                    <table class="data-table">
                        <tr><th>Audio</th><th>Question</th><th>Answer</th></tr>
                        <tr>
                            <td><button class="btn-audio" onclick="speak('Will you marry me?')"><i class="fas fa-volume-up"></i></button></td>
                            <td class="mono"><b>Will</b> you marry me?</td>
                            <td>Yes, I will.</td>
                        </tr>
                        <tr>
                            <td><button class="btn-audio" onclick="speak('When will they arrive?')"><i class="fas fa-volume-up"></i></button></td>
                            <td class="mono">When <b>will</b> they arrive?</td>
                            <td>At 5 PM.</td>
                        </tr>
                    </table>
                </div>
                <button class="btn-xl" onclick="nav('workshop')">Practicar en Taller <i class="fas fa-hammer"></i></button>
            </div>
        </section>

        <section id="sec-workshop" class="section">
            <div class="card">
                <h2>Structure Builder</h2>
                <p>Ordena las palabras.</p>
                
                <div class="workshop-area">
                    <h3 id="targetSentence" style="color:var(--text-muted); margin-bottom:20px;">Cargando...</h3>
                    <div class="slot-zone" id="dropArea"></div>
                    <div class="chip-bank" id="chipBank" style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center;"></div>
                    <div class="feedback" id="wsFeedback"></div>
                </div>

                <button class="btn-xl" onclick="checkWorkshop()">Verificar</button>
                <button class="btn-xl btn-outline" onclick="resetWorkshop()">Siguiente</button>
            </div>
        </section>

        <section id="sec-dictation" class="section">
            <div class="card">
                <h2>Dictation Mode</h2>
                <p>Escucha y escribe. ¿Es 'Won't' o 'Want'?</p>
                
                <div class="workshop-area">
                    <button class="btn-audio" style="width:60px; height:60px; font-size:1.5rem; background:var(--brand); color:white; border:none; margin-bottom:1rem;" onclick="playDictation()"><i class="fas fa-play"></i></button>
                    <p style="font-size:0.9rem;">Pulsa para escuchar</p>
                    <input type="text" class="input-lg" id="dictInput" placeholder="Escribe lo que escuchas..." autocomplete="off">
                </div>
                
                <div class="feedback" id="dictFeedback"></div>
                <button class="btn-xl" onclick="checkDictation()">Comprobar</button>
            </div>
        </section>

        <section id="sec-quiz" class="section">
            <div class="card">
                <h2>Certification</h2>
                <div id="quiz-ui">
                    <div style="margin:20px 0; height:6px; background:var(--element-bg); border-radius:10px;"><div id="quizProgress" style="height:100%; width:0%; background:var(--brand); transition:0.3s;"></div></div>
                    <div id="questionBox" style="font-size:1.4rem; font-weight:700; margin-bottom:2rem; text-align:center;"></div>
                    <div id="optionsBox"></div>
                </div>
                <div id="quiz-results" style="display:none; text-align:center; padding:2rem;">
                    <h2 style="color:var(--success);">Complete!</h2>
                    <p id="finalScore" style="font-size:2rem; font-weight:800;"></p>
                    <button class="btn-xl" onclick="location.reload()">Reiniciar</button>
                </div>
            </div>
        </section>

    </main>
</div>

<footer class="footer-ribbon">
    <div class="footer-grid">
        <div class="footer-col">
            <h5>Rators Club</h5>
            <p>Ingeniería lingüística avanzada.</p>
        </div>
        <div class="footer-col">
            <h5>Creator</h5>
            <p><b>Teacher Netza Varo</b><br>Tepic, Nayarit.<br>Est. 2026</p>
        </div>
        <div class="footer-col">
            <h5>License</h5>
            <p>GNU GPL v3.0</p>
        </div>
    </div>
    <div class="legal">
        BUILT WITH <i class="fas fa-bolt" style="color:var(--brand);"></i> IN MEXICO
    </div>
</footer>

<script>
    /* ========================================
       TITAN ENGINE V3 (Robust Audio & Logic)
       ======================================== */
    
    // --- 1. AUDIO ENGINE (FORCED ENGLISH) ---
    const synth = window.speechSynthesis;
    let engVoice = null;

    function loadVoices() {
        const voices = synth.getVoices();
        engVoice = voices.find(v => v.name.includes("Google US")) 
                || voices.find(v => v.lang === "en-US") 
                || voices.find(v => v.lang.startsWith("en"));
    }
    
    if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = loadVoices;
    }

    function speak(text) {
        if (synth.speaking) synth.cancel();
        if (!engVoice) loadVoices();
        
        const utter = new SpeechSynthesisUtterance(text);
        if (engVoice) utter.voice = engVoice;
        utter.lang = 'en-US';
        utter.rate = 0.9;
        synth.speak(utter);
    }

    function unlockAudio() {
        if (synth.paused) synth.resume();
        loadVoices();
    }

    function initSystem() {
        loadVoices();
        if(localStorage.getItem('rators-theme') === 'dark') {
            document.body.classList.add('dark-mode');
        }
    }

    // --- 2. UI LOGIC ---
    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }
    function toggleTheme() {
        document.body.classList.toggle('dark-mode');
        localStorage.setItem('rators-theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
    }

    function nav(id, btn) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById('sec-' + id).classList.add('active');
        
        if(btn) {
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            if(window.innerWidth <= 1024) toggleSidebar();
        }
        window.scrollTo(0,0);

        if(id === 'workshop') initWorkshop();
        if(id === 'dictation') initDictation();
        if(id === 'quiz') initQuiz();
    }

    // --- 3. WORKSHOP ---
    const wsData = [
        { es: "Yo te llamaré.", words: ["I", "will", "call", "you", "."], correct: "I will call you ." },
        { es: "No iré.", words: ["I", "won't", "go", "."], correct: "I won't go ." },
        { es: "¿Lloverá?", words: ["Will", "it", "rain", "?"], correct: "Will it rain ?" },
        { es: "Ella estará aquí.", words: ["She", "will", "be", "here", "."], correct: "She will be here ." },
        { es: "No lo haremos.", words: ["We", "won't", "do", "it", "."], correct: "We won't do it ." }
    ];
    let wsIdx = 0;

    function initWorkshop() {
        const data = wsData[wsIdx];
        document.getElementById('targetSentence').innerText = data.es;
        const bank = document.getElementById('chipBank');
        const drop = document.getElementById('dropArea');
        const fb = document.getElementById('wsFeedback');
        
        bank.innerHTML = ''; drop.innerHTML = ''; fb.style.display = 'none';

        let chips = [...data.words].sort(() => Math.random() - 0.5);
        chips.forEach(word => {
            const chip = document.createElement('div');
            chip.className = 'chip';
            chip.innerText = word;
            chip.onclick = () => {
                if(chip.parentElement === bank) { drop.appendChild(chip); speak(word); }
                else { bank.appendChild(chip); }
            };
            bank.appendChild(chip);
        });
    }

    function checkWorkshop() {
        const attempt = Array.from(document.getElementById('dropArea').children).map(c => c.innerText).join(' ');
        const correct = wsData[wsIdx].correct;
        const fb = document.getElementById('wsFeedback');
        
        fb.style.display = 'block';
        if(attempt === correct) {
            fb.className = 'feedback success';
            fb.innerHTML = 'Correct!';
            confetti({ particleCount: 50, spread: 60, origin: { y: 0.6 } });
            speak("Correct!");
            setTimeout(() => { wsIdx = (wsIdx + 1) % wsData.length; initWorkshop(); }, 2000);
        } else {
            fb.className = 'feedback error';
            fb.innerHTML = 'Incorrect structure.';
            speak("Try again");
        }
    }
    function resetWorkshop() { initWorkshop(); }

    // --- 4. DICTATION ---
    const dictSentences = [
        "I will help you",
        "It won't rain today",
        "Will you marry me",
        "She'll be here soon",
        "I think they will win",
        "He won't eat that",
        "We'll see you tomorrow"
    ];
    let dicIdx = 0;

    function initDictation() {
        document.getElementById('dictInput').value = '';
        document.getElementById('dictFeedback').style.display = 'none';
    }
    function playDictation() { speak(dictSentences[dicIdx]); }
    function checkDictation() {
        const val = document.getElementById('dictInput').value.trim();
        const target = dictSentences[dicIdx];
        const fb = document.getElementById('dictFeedback');
        fb.style.display = 'block';
        
        const cleanVal = val.replace(/[.,?']/g, '').toLowerCase().trim();
        const cleanTarget = target.replace(/[.,?']/g, '').toLowerCase().trim();

        if(cleanVal === cleanTarget) {
            fb.className = 'feedback success';
            fb.innerHTML = `Perfect! "${target}"`;
            confetti({ particleCount: 50, spread: 50 });
            setTimeout(() => { dicIdx = (dicIdx + 1) % dictSentences.length; initDictation(); }, 2500);
        } else {
            fb.className = 'feedback error';
            fb.innerHTML = 'Listen closely.';
        }
    }

    // --- 5. QUIZ ---
    const quizQ = [
        { q: "She ____ (help) us.", opts: ["will help", "wills help", "will helps"], a: "will help" },
        { q: "I ____ (not/go).", opts: ["don't go", "won't go", "won't goes"], a: "won't go" },
        { q: "____ (you/come)?", opts: ["Will you come", "Do you come", "Will you coming"], a: "Will you come" },
        { q: "It ____ (be) fine.", opts: ["will be", "will is", "will to be"], a: "will be" },
        { q: "Wait! I ____ (open) it.", opts: ["will open", "open", "going to open"], a: "will open" },
        { q: "They ____ (not/win).", opts: ["won't win", "not win", "willn't win"], a: "won't win" },
        { q: "What ____ (happen)?", opts: ["will happen", "happen will", "will happens"], a: "will happen" },
        { q: "We ____ (see) you.", opts: ["will see", "see", "will seeing"], a: "will see" }
    ];
    let qIdx = 0; let score = 0;

    function initQuiz() {
        qIdx = 0; score = 0;
        document.getElementById('quiz-ui').style.display = 'block';
        document.getElementById('quiz-results').style.display = 'none';
        renderQuestion();
    }

    function renderQuestion() {
        if(qIdx >= quizQ.length) return finishQuiz();
        const data = quizQ[qIdx];
        document.getElementById('questionBox').innerText = `${qIdx+1}. ${data.q}`;
        const box = document.getElementById('optionsBox');
        box.innerHTML = '';
        data.opts.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'btn-xl btn-outline';
            btn.style.marginTop = '10px';
            btn.innerText = opt;
            btn.onclick = () => { if(opt === data.a) score++; qIdx++; renderQuestion(); };
            box.appendChild(btn);
        });
    }

    function finishQuiz() {
        document.getElementById('quiz-ui').style.display = 'none';
        document.getElementById('quiz-results').style.display = 'block';
        document.getElementById('finalScore').innerText = `Score: ${score} / ${quizQ.length}`;
        if(score >= 6) confetti();
    }
</script>

</body>
</html>
