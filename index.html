<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Future Architect | Rators Club</title>
    
    <link rel="icon" href="https://drive.google.com/thumbnail?id=1bOFY9XiVAv-WRQnVHXSnL5FHVEoK3UAp&sz=w128" type="image/png">
    
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,600;0,700;1,400&family=Nunito+Sans:wght@300;400;600;700;800&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

    <style>
        /* ========================================
           SYSTEM: TITAN ARCHITECT V4 (GRID CORE)
           ======================================== */
        :root {
            /* --- LIGHT THEME VARIABLES --- */
            --bg-body: #f1f5f9;       /* Slate 100 */
            --bg-card: #ffffff;       /* White */
            --bg-sidebar: #ffffff;
            --bg-input: #f8fafc;      /* Slate 50 */
            
            --text-primary: #0f172a;  /* Slate 900 */
            --text-secondary: #475569;/* Slate 600 */
            --text-muted: #94a3b8;    /* Slate 400 */
            --text-inverse: #ffffff;
            
            --border: #e2e8f0;        /* Slate 200 */
            
            /* Functional Colors */
            --brand: #0891b2;         /* Cyan 600 */
            --brand-hover: #0e7490;   /* Cyan 700 */
            
            --will: #06b6d4;          /* Cyan 500 */
            --will-light: #ecfeff;    /* Cyan 50 */
            
            --wont: #f43f5e;          /* Rose 500 */
            --wont-light: #fff1f2;    /* Rose 50 */
            
            --success: #10b981;       /* Emerald 500 */
            --success-bg: #ecfdf5;
            
            --shadow-card: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            --shadow-float: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        /* --- DARK THEME VARIABLES (High Contrast) --- */
        body.dark-mode {
            --bg-body: #020617;       /* Slate 950 */
            --bg-card: #1e293b;       /* Slate 800 */
            --bg-sidebar: #0f172a;    /* Slate 900 */
            --bg-input: #334155;      /* Slate 700 */
            
            --text-primary: #ffffff;  /* White */
            --text-secondary: #cbd5e1;/* Slate 300 */
            --text-muted: #64748b;    /* Slate 500 */
            --text-inverse: #0f172a;
            
            --border: #334155;        /* Slate 700 */
            
            --brand: #22d3ee;         /* Cyan 400 */
            --brand-hover: #67e8f9;
            
            --will: #22d3ee;          /* Cyan 400 */
            --will-light: rgba(34, 211, 238, 0.1);
            
            --wont: #fb7185;          /* Rose 400 */
            --wont-light: rgba(251, 113, 133, 0.1);
            
            --success: #34d399;
            --success-bg: rgba(52, 211, 153, 0.1);
        }

        /* --- RESET & BASE --- */
        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: 'Nunito Sans', sans-serif; 
            background: var(--bg-body); color: var(--text-primary); 
            line-height: 1.6; font-size: 16px;
            transition: background 0.3s ease, color 0.3s ease;
        }

        /* --- LAYOUT GRID ENGINE (The Fix) --- */
        .app-container {
            display: grid;
            grid-template-columns: 280px 1fr; /* PC: Sidebar Fija | Contenido */
            min-height: 100vh;
        }

        /* --- SIDEBAR (PC) --- */
        .sidebar {
            background: var(--bg-sidebar);
            border-right: 1px solid var(--border);
            position: sticky; top: 0; height: 100vh;
            overflow-y: auto; padding: 2rem 1.5rem;
            display: flex; flex-direction: column; z-index: 50;
        }

        /* --- CONTENT AREA --- */
        .main-content {
            padding: 3rem 4rem;
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
        }

        /* --- MOBILE HEADER (Visible only on mobile) --- */
        .mobile-header {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 64px;
            background: var(--bg-card); border-bottom: 1px solid var(--border);
            z-index: 100; align-items: center; justify-content: space-between; padding: 0 1.2rem;
            box-shadow: var(--shadow-card);
        }

        /* --- RESPONSIVE BREAKPOINT (Tablet/Mobile) --- */
        @media (max-width: 1024px) {
            .app-container { display: block; } /* Disable Grid */
            .sidebar {
                position: fixed; top: 0; left: 0; width: 85%; max-width: 320px; height: 100vh;
                transform: translateX(-100%); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                box-shadow: 10px 0 30px rgba(0,0,0,0.5); z-index: 2000;
            }
            .sidebar.active { transform: translateX(0); }
            .mobile-header { display: flex; }
            .main-content { padding: 80px 1.2rem 4rem; }
            
            /* Overlay when sidebar is open */
            .overlay {
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.5); z-index: 1900; display: none; backdrop-filter: blur(4px);
            }
            .overlay.active { display: block; }
        }

        /* --- TYPOGRAPHY --- */
        h1, h2, h3 { font-family: 'Lora', serif; font-weight: 700; color: var(--text-primary); line-height: 1.2; }
        h1 { font-size: clamp(2rem, 4vw, 3rem); margin-bottom: 0.5rem; }
        p { color: var(--text-secondary); margin-bottom: 1.5rem; }
        .mono { font-family: 'JetBrains Mono', monospace; font-size: 0.95em; }

        /* --- COMPONENTS --- */
        
        /* Nav Items */
        .brand { display: flex; align-items: center; gap: 12px; font-weight: 800; font-size: 1.2rem; color: var(--text-primary); margin-bottom: 2rem; }
        .brand img { width: 40px; border-radius: 10px; }
        
        .nav-category { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1.5px; color: var(--text-muted); font-weight: 800; margin: 1.5rem 0 0.8rem 10px; }
        
        .nav-btn {
            display: flex; align-items: center; gap: 14px; padding: 12px 16px; width: 100%;
            border: none; background: transparent; color: var(--text-secondary); font-weight: 600;
            border-radius: 12px; cursor: pointer; transition: 0.2s; text-align: left; margin-bottom: 4px; font-size: 0.95rem;
        }
        .nav-btn:hover { background: var(--bg-input); color: var(--text-primary); }
        .nav-btn.active { background: var(--brand); color: #ffffff; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        
        /* Cards */
        .section { display: none; animation: fadeUp 0.4s ease; }
        .section.active { display: block; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        .card {
            background: var(--bg-card); border: 1px solid var(--border); border-radius: 20px;
            padding: 2.5rem; margin-bottom: 2rem; box-shadow: var(--shadow-card);
        }

        .badge { 
            display: inline-block; padding: 6px 14px; border-radius: 50px; 
            font-size: 0.7rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1px;
            margin-bottom: 1.5rem; border: 1px solid;
        }
        .bg-will { background: var(--will-light); color: var(--will); border-color: var(--will); }
        .bg-wont { background: var(--wont-light); color: var(--wont); border-color: var(--wont); }

        /* Grids & Flex */
        .grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 2rem 0; }
        
        .feature-box {
            padding: 2rem; border-radius: 16px; background: var(--bg-input);
            border: 2px solid transparent; cursor: pointer; transition: 0.3s; text-align: center;
        }
        .feature-box:hover { transform: translateY(-5px); border-color: var(--brand); box-shadow: var(--shadow-float); background: var(--bg-card); }
        .icon-lg { font-size: 3rem; margin-bottom: 1rem; display: block; color: var(--brand); }

        /* Formula Builder */
        .formula-bar {
            background: var(--bg-input); border: 1px solid var(--border); border-radius: 16px; padding: 1.5rem;
            display: flex; flex-wrap: wrap; gap: 10px; align-items: center; justify-content: center;
            margin: 1.5rem 0; font-family: 'JetBrains Mono';
        }
        .block {
            padding: 10px 18px; border-radius: 8px; font-weight: 700; font-size: 0.9rem;
            background: var(--bg-card); border: 1px solid var(--border); color: var(--text-primary);
        }
        .hl-will { background: var(--will); color: white; border-color: var(--will); }
        .hl-wont { background: var(--wont); color: white; border-color: var(--wont); }

        /* Audio & Tables */
        .btn-audio {
            width: 44px; height: 44px; border-radius: 50%; border: 2px solid var(--border);
            background: var(--bg-card); color: var(--text-primary); cursor: pointer;
            display: flex; align-items: center; justify-content: center; transition: 0.2s;
        }
        .btn-audio:hover { background: var(--text-primary); color: var(--bg-card); }

        .table-scroll { overflow-x: auto; border: 1px solid var(--border); border-radius: 12px; margin-top: 2rem; }
        .data-table { width: 100%; border-collapse: collapse; min-width: 600px; }
        .data-table th { text-align: left; padding: 16px; background: var(--bg-input); color: var(--text-muted); font-size: 0.8rem; text-transform: uppercase; border-bottom: 1px solid var(--border); }
        .data-table td { padding: 16px; border-bottom: 1px solid var(--border); color: var(--text-primary); }
        .data-table tr:last-child td { border-bottom: none; }

        /* Inputs & Workshop */
        .input-lg {
            width: 100%; padding: 18px; border-radius: 12px; border: 2px solid var(--border);
            background: var(--bg-input); color: var(--text-primary); font-family: 'JetBrains Mono';
            font-size: 1.2rem; text-align: center; margin: 20px 0; outline: none; transition: 0.3s;
        }
        .input-lg:focus { border-color: var(--brand); background: var(--bg-card); }

        .chip-zone {
            display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; padding: 20px;
            background: var(--bg-input); border-radius: 16px; border: 2px dashed var(--border); min-height: 80px; margin-bottom: 2rem;
        }
        .chip {
            padding: 12px 20px; background: var(--bg-card); border: 2px solid var(--border);
            border-radius: 10px; color: var(--text-primary); font-weight: 700; cursor: pointer;
            user-select: none; transition: 0.1s; font-family: 'JetBrains Mono';
        }
        .chip:hover { border-color: var(--brand); color: var(--brand); transform: translateY(-2px); }
        .chip:active { transform: scale(0.95); }

        /* Buttons */
        .btn-primary {
            width: 100%; padding: 20px; border-radius: 14px; border: none; font-size: 1.1rem;
            font-weight: 700; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 12px;
            background: var(--brand); color: #ffffff; margin-top: 1.5rem;
        }
        .btn-primary:hover { background: var(--brand-hover); box-shadow: 0 10px 20px rgba(0,0,0,0.1); transform: translateY(-2px); }
        
        .btn-outline {
            width: 100%; padding: 18px; border-radius: 14px; border: 2px solid var(--border);
            background: transparent; color: var(--text-primary); font-weight: 700; cursor: pointer; margin-top: 10px;
        }
        .btn-outline:hover { background: var(--bg-input); border-color: var(--text-primary); }

        /* Footer */
        .footer {
            background: var(--bg-card); border-top: 1px solid var(--border); padding: 3rem 2rem; margin-top: 4rem;
        }
        .footer-content { max-width: 1200px; margin: 0 auto; text-align: center; color: var(--text-secondary); }
        .legal { font-size: 0.8rem; font-family: 'JetBrains Mono'; opacity: 0.6; margin-top: 2rem; border-top: 1px solid var(--border); padding-top: 2rem; }

        /* Feedback */
        .feedback { display: none; padding: 15px; border-radius: 12px; margin-top: 20px; font-weight: 700; text-align: center; }
        .feedback.ok { background: var(--success-bg); color: var(--success); border: 1px solid var(--success); }
        .feedback.err { background: var(--wont-light); color: var(--wont); border: 1px solid var(--wont); }

    </style>
</head>
<body onload="init()">

<div class="overlay" onclick="closeSidebar()"></div>

<div class="mobile-header">
    <div class="brand" style="margin:0;">
        <img src="https://drive.google.com/thumbnail?id=1bOFY9XiVAv-WRQnVHXSnL5FHVEoK3UAp&sz=w128" alt="Logo">
        Future Titan
    </div>
    <div onclick="openSidebar()" style="font-size:1.5rem; color:var(--text-primary); cursor:pointer;"><i class="fas fa-bars"></i></div>
</div>

<div class="app-container">

    <nav class="sidebar" id="sidebar">
        <div class="brand">
            <img src="https://drive.google.com/thumbnail?id=1bOFY9XiVAv-WRQnVHXSnL5FHVEoK3UAp&sz=w128" alt="Logo">
            Rators Club
        </div>

        <div class="nav-category">Core Theory</div>
        <button class="nav-btn active" onclick="nav('intro', this)"><i class="fas fa-rocket"></i> Intro & Logic</button>
        <button class="nav-btn" onclick="nav('structure', this)"><i class="fas fa-robot"></i> The Robot Rule</button>
        <button class="nav-btn" onclick="nav('usage', this)"><i class="fas fa-th-large"></i> The 4 Pillars</button>

        <div class="nav-category">Mechanics</div>
        <button class="nav-btn" onclick="nav('contractions', this)"><i class="fas fa-compress-arrows-alt"></i> Contractions ('ll)</button>
        <button class="nav-btn" onclick="nav('negative', this)"><i class="fas fa-ban"></i> Won't vs Want</button>
        <button class="nav-btn" onclick="nav('questions', this)"><i class="fas fa-question-circle"></i> Questions</button>

        <div class="nav-category">Lab</div>
        <button class="nav-btn" onclick="nav('workshop', this)"><i class="fas fa-hammer"></i> Structure Builder</button>
        <button class="nav-btn" onclick="nav('dictation', this)"><i class="fas fa-microphone-alt"></i> Dictation Mode</button>
        <button class="nav-btn" onclick="nav('quiz', this)"><i class="fas fa-trophy"></i> Certification</button>

        <div style="margin-top:auto; padding-top:20px;">
            <button class="nav-btn" onclick="toggleTheme()" style="justify-content:center; background:var(--bg-input);">
                <i class="fas fa-moon"></i> Switch Theme
            </button>
        </div>
    </nav>

    <main class="main-content">
        
        <section id="sec-intro" class="section active">
            <div class="card">
                <span class="badge bg-will">Module 02</span>
                <h1>The Instant <span>Future</span></h1>
                <p>El "Will" no es para planes (Going to). El "Will" es para el futuro que nace <b>en este instante</b>: decisiones, promesas y predicciones espontáneas.</p>
                
                <div class="grid-2">
                    <div class="feature-box" onclick="nav('structure')">
                        <i class="fas fa-robot icon-lg" style="color:var(--will);"></i>
                        <h3>The Robot Rule</h3>
                        <p>El auxiliar <b>Will</b> es invariable. Trata a todos los sujetos igual. Nunca cambia.</p>
                    </div>
                    <div class="feature-box" onclick="nav('usage')">
                        <i class="fas fa-bolt icon-lg"></i>
                        <h3>Spontaneous</h3>
                        <p>No lo pensaste ayer. Lo decidiste ahora mismo. Es una reacción.</p>
                    </div>
                </div>

                <button class="btn-primary" onclick="nav('structure')">Entender Estructura <i class="fas fa-arrow-right"></i></button>
            </div>
        </section>

        <section id="sec-structure" class="section">
            <div class="card">
                <span class="badge bg-will">Logic</span>
                <h2>The <span style="color:var(--will);">Robot</span> Rule</h2>
                <p>Olvídate de la "S". Olvídate del "To". Después de <b>Will</b>, el verbo va en su forma <b>BASE</b>.</p>

                <div class="formula-bar">
                    <div class="block">Subject</div> <i class="fas fa-plus"></i>
                    <div class="block hl-will">WILL</div> <i class="fas fa-plus"></i>
                    <div class="block">Base Verb</div>
                </div>

                <div class="table-scroll">
                    <table class="data-table">
                        <tr><th>Audio</th><th>Sentence</th><th>Note</th></tr>
                        <tr>
                            <td><button class="btn-audio" onclick="speak('She will call you')"><i class="fas fa-volume-up"></i></button></td>
                            <td class="mono">She <b>will</b> call you.</td>
                            <td>No 'calls'.</td>
                        </tr>
                        <tr>
                            <td><button class="btn-audio" onclick="speak('We will be there')"><i class="fas fa-volume-up"></i></button></td>
                            <td class="mono">We <b>will</b> be there.</td>
                            <td>'Be' is base.</td>
                        </tr>
                    </table>
                </div>
                <button class="btn-primary" onclick="nav('usage')">Ver los 4 Pilares <i class="fas fa-th-large"></i></button>
            </div>
        </section>

        <section id="sec-usage" class="section">
            <div class="card">
                <h2>The 4 Pillars of <span style="color:var(--will);">Will</span></h2>
                <div class="grid-2">
                    <div class="feature-box" onclick="speak('I will help you.')">
                        <i class="fas fa-hand-holding-heart icon-lg" style="color:var(--will);"></i>
                        <h4>Offer / Ayuda</h4>
                        <p class="mono">"I'll help you with that."</p>
                    </div>
                    <div class="feature-box" onclick="speak('I promise I will call.')">
                        <i class="fas fa-ring icon-lg" style="color:var(--will);"></i>
                        <h4>Promise</h4>
                        <p class="mono">"I will call you."</p>
                    </div>
                    <div class="feature-box" onclick="speak('It will rain tomorrow.')">
                        <i class="fas fa-crystal-ball icon-lg" style="color:var(--will);"></i>
                        <h4>Prediction</h4>
                        <p class="mono">"It will rain tomorrow."</p>
                    </div>
                    <div class="feature-box" onclick="speak('I will take it.')">
                        <i class="fas fa-shopping-cart icon-lg" style="color:var(--will);"></i>
                        <h4>Decision</h4>
                        <p class="mono">"I'll take it."</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="sec-contractions" class="section">
            <div class="card">
                <h2>The <span style="color:var(--text-secondary);">'ll</span> Sound</h2>
                <p>Los nativos no dicen "I will". Usan la contracción <b>'ll</b> (L oscura).</p>
                
                <div class="grid-2">
                    <div class="feature-box" onclick="speak('I\'ll see you')">
                        <h3>I'll</h3>
                        <p class="mono">/aɪl/</p>
                        <small>"Ail"</small>
                    </div>
                    <div class="feature-box" onclick="speak('You\'ll love it')">
                        <h3>You'll</h3>
                        <p class="mono">/juːl/</p>
                        <small>"Yul"</small>
                    </div>
                    <div class="feature-box" onclick="speak('It\'ll be fine')">
                        <h3>It'll</h3>
                        <p class="mono">/ˈɪtəl/</p>
                        <small>"Í-tol"</small>
                    </div>
                </div>
                <button class="btn-primary" style="background:var(--wont);" onclick="nav('negative')">Alerta: Won't vs Want <i class="fas fa-ban"></i></button>
            </div>
        </section>

        <section id="sec-negative" class="section">
            <div class="card" style="border-top:5px solid var(--wont);">
                <h2 style="color:var(--wont);">Won't vs. Want</h2>
                <p>La pronunciación más confusa del inglés. Entrena tu oído.</p>
                
                <div class="grid-2">
                    <div class="feature-box" onclick="speak('I won\'t go.')" style="background:var(--wont-light); border-color:var(--wont);">
                        <h3 style="color:var(--wont);">Won't</h3>
                        <p>No lo haré.</p>
                        <p class="mono" style="font-size:1.5rem;">/woʊnt/</p>
                        <small>Sonido "OU" (Go). Labios redondos.</small>
                    </div>
                    <div class="feature-box" onclick="speak('I want to go.')">
                        <h3>Want</h3>
                        <p>Querer.</p>
                        <p class="mono" style="font-size:1.5rem;">/wɑːnt/</p>
                        <small>Sonido "A". Boca relajada.</small>
                    </div>
                </div>

                <h3>Formula</h3>
                <div class="formula-bar">
                    <div class="block">Subject</div> <i class="fas fa-plus"></i>
                    <div class="block hl-wont">WON'T</div> <i class="fas fa-plus"></i>
                    <div class="block">Base Verb</div>
                </div>
            </div>
        </section>

        <section id="sec-questions" class="section">
            <div class="card">
                <h2>Questions</h2>
                <div class="formula-bar">
                    <div class="block hl-will">WILL</div> <i class="fas fa-plus"></i>
                    <div class="block">Subject</div> <i class="fas fa-plus"></i>
                    <div class="block">Base Verb ?</div>
                </div>
                <div class="table-scroll">
                    <table class="data-table">
                        <tr><th>Audio</th><th>Question</th><th>Answer</th></tr>
                        <tr>
                            <td><button class="btn-audio" onclick="speak('Will you marry me?')"><i class="fas fa-volume-up"></i></button></td>
                            <td class="mono"><b>Will</b> you marry me?</td>
                            <td>Yes, I will.</td>
                        </tr>
                        <tr>
                            <td><button class="btn-audio" onclick="speak('When will they arrive?')"><i class="fas fa-volume-up"></i></button></td>
                            <td class="mono">When <b>will</b> they arrive?</td>
                            <td>Soon.</td>
                        </tr>
                    </table>
                </div>
                <button class="btn-primary" onclick="nav('workshop')">Practicar <i class="fas fa-hammer"></i></button>
            </div>
        </section>

        <section id="sec-workshop" class="section">
            <div class="card">
                <h2>Structure Builder</h2>
                <p>Ordena las palabras.</p>
                
                <div class="workshop-area">
                    <h3 id="targetSentence" style="color:var(--text-muted); margin-bottom:20px;">Cargando...</h3>
                    <div class="chip-zone" id="dropArea"></div>
                    <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center;" id="chipBank"></div>
                    <div class="feedback" id="wsFeedback"></div>
                </div>

                <button class="btn-primary" onclick="checkWorkshop()">Verificar</button>
                <button class="btn-outline" onclick="initWorkshop()">Siguiente / Reset</button>
            </div>
        </section>

        <section id="sec-dictation" class="section">
            <div class="card">
                <h2>Dictation Mode</h2>
                <p>Escucha y escribe. ¿Es "Won't" o "Want"?</p>
                
                <div class="workshop-area">
                    <button class="btn-audio" style="width:60px; height:60px; font-size:1.5rem; background:var(--brand); color:white; border:none; margin-bottom:1rem;" onclick="playDictation()"><i class="fas fa-play"></i></button>
                    <p style="font-size:0.9rem;">Pulsa para escuchar</p>
                    <input type="text" class="input-lg" id="dictInput" placeholder="Escribe aquí..." autocomplete="off">
                </div>
                
                <div class="feedback" id="dictFeedback"></div>
                <button class="btn-primary" onclick="checkDictation()">Comprobar</button>
            </div>
        </section>

        <section id="sec-quiz" class="section">
            <div class="card">
                <h2>Certification</h2>
                <div id="quiz-ui">
                    <div style="margin:20px 0; height:6px; background:var(--bg-input); border-radius:10px;"><div id="quizProgress" style="height:100%; width:0%; background:var(--brand); transition:0.3s;"></div></div>
                    <div id="questionBox" style="font-size:1.4rem; font-weight:700; margin-bottom:2rem; text-align:center;"></div>
                    <div id="optionsBox"></div>
                </div>
                <div id="quiz-results" style="display:none; text-align:center; padding:2rem;">
                    <h2 style="color:var(--success);">Protocolo Completado</h2>
                    <p id="finalScore" style="font-size:2rem; font-weight:800; color:var(--text-primary); margin:1rem 0;"></p>
                    <button class="btn-primary" onclick="location.reload()">Reiniciar</button>
                </div>
            </div>
        </section>

    </main>

</div>

<footer class="footer">
    <div class="footer-content">
        <div style="display:flex; justify-content:center; gap:3rem; flex-wrap:wrap;">
            <div>
                <h5 style="color:var(--text-primary); margin-bottom:1rem;">Rators Club</h5>
                <p>Ingeniería lingüística avanzada.</p>
            </div>
            <div>
                <h5 style="color:var(--text-primary); margin-bottom:1rem;">Creator</h5>
                <p>Teacher Netza Varo<br>Tepic, Nayarit.</p>
            </div>
        </div>
        <div class="legal">
            TITAN ARCHITECT V4 | GNU GPL V3.0 | BUILT WITH <i class="fas fa-bolt" style="color:var(--brand);"></i>
        </div>
    </div>
</footer>

<script>
    /* ========================================
       TITAN V4 ENGINE: ROBUST LOGIC
       ======================================== */
    
    // --- AUDIO SYSTEM ---
    const synth = window.speechSynthesis;
    let engVoice = null;

    function loadVoices() {
        const voices = synth.getVoices();
        engVoice = voices.find(v => v.name.includes("Google US")) 
                || voices.find(v => v.lang === "en-US") 
                || voices.find(v => v.lang.startsWith("en"));
    }
    if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = loadVoices;
    }

    function speak(text) {
        if (synth.speaking) synth.cancel(); // Cancel queue
        if (!engVoice) loadVoices();
        
        const utter = new SpeechSynthesisUtterance(text);
        if (engVoice) utter.voice = engVoice;
        utter.lang = 'en-US';
        utter.rate = 0.9;
        synth.speak(utter);
    }

    function init() {
        loadVoices();
        // Theme check
        if(localStorage.getItem('rators-theme') === 'dark') {
            document.body.classList.add('dark-mode');
        }
    }

    // --- UI LOGIC ---
    function openSidebar() { document.getElementById('sidebar').classList.add('active'); document.querySelector('.overlay').classList.add('active'); }
    function closeSidebar() { document.getElementById('sidebar').classList.remove('active'); document.querySelector('.overlay').classList.remove('active'); }
    
    function toggleTheme() {
        document.body.classList.toggle('dark-mode');
        localStorage.setItem('rators-theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
    }

    function nav(id, btn) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById('sec-' + id).classList.add('active');
        
        if(btn) {
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            if(window.innerWidth <= 1024) closeSidebar(); // Auto-close on mobile
        }
        window.scrollTo(0,0);

        // Init modules
        if(id === 'workshop') initWorkshop();
        if(id === 'dictation') initDictation();
        if(id === 'quiz') initQuiz();
    }

    // --- WORKSHOP ---
    const wsData = [
        { es: "Yo te ayudaré.", words: ["I", "will", "help", "you", "."], correct: "I will help you ." },
        { es: "No lo haré.", words: ["I", "won't", "do", "it", "."], correct: "I won't do it ." },
        { es: "¿Lloverá?", words: ["Will", "it", "rain", "?"], correct: "Will it rain ?" },
        { es: "Ella estará bien.", words: ["She", "will", "be", "fine", "."], correct: "She will be fine ." },
        { es: "No vendremos.", words: ["We", "won't", "come", "."], correct: "We won't come ." }
    ];
    let wsIdx = 0;

    function initWorkshop() {
        const data = wsData[wsIdx];
        document.getElementById('targetSentence').innerText = data.es;
        const bank = document.getElementById('chipBank');
        const drop = document.getElementById('dropArea');
        const fb = document.getElementById('wsFeedback');
        
        bank.innerHTML = ''; drop.innerHTML = ''; fb.style.display = 'none';

        let chips = [...data.words].sort(() => Math.random() - 0.5);
        chips.forEach(word => {
            const chip = document.createElement('div');
            chip.className = 'chip';
            chip.innerText = word;
            chip.onclick = () => {
                if(chip.parentElement === bank) { drop.appendChild(chip); speak(word); }
                else { bank.appendChild(chip); }
            };
            bank.appendChild(chip);
        });
    }

    function checkWorkshop() {
        const attempt = Array.from(document.getElementById('dropArea').children).map(c => c.innerText).join(' ');
        const correct = wsData[wsIdx].correct;
        const fb = document.getElementById('wsFeedback');
        
        fb.style.display = 'block';
        if(attempt === correct) {
            fb.className = 'feedback ok';
            fb.innerHTML = 'Correct! Next...';
            confetti({ particleCount: 50, spread: 60, origin: { y: 0.6 } });
            speak("Correct!");
            setTimeout(() => { wsIdx = (wsIdx + 1) % wsData.length; initWorkshop(); }, 1500);
        } else {
            fb.className = 'feedback err';
            fb.innerHTML = 'Incorrect structure.';
            speak("Try again");
        }
    }

    // --- DICTATION ---
    const dictSentences = [
        "I will help you",
        "It won't rain today",
        "Will you marry me",
        "She'll be here soon",
        "I think they will win",
        "He won't eat that",
        "We'll see you tomorrow"
    ];
    let dicIdx = 0;

    function initDictation() {
        document.getElementById('dictInput').value = '';
        document.getElementById('dictFeedback').style.display = 'none';
    }
    function playDictation() { speak(dictSentences[dicIdx]); }
    function checkDictation() {
        const val = document.getElementById('dictInput').value.trim();
        const target = dictSentences[dicIdx];
        const fb = document.getElementById('dictFeedback');
        fb.style.display = 'block';
        
        const cleanVal = val.replace(/[.,?']/g, '').toLowerCase().trim();
        const cleanTarget = target.replace(/[.,?']/g, '').toLowerCase().trim();

        if(cleanVal === cleanTarget) {
            fb.className = 'feedback ok';
            fb.innerHTML = `Perfect! "${target}"`;
            confetti({ particleCount: 50, spread: 50 });
            setTimeout(() => { dicIdx = (dicIdx + 1) % dictSentences.length; initDictation(); }, 2000);
        } else {
            fb.className = 'feedback err';
            fb.innerHTML = 'Listen closely.';
        }
    }

    // --- QUIZ ---
    const quizQ = [
        { q: "She ____ (help) us.", opts: ["will help", "wills help", "will helps"], a: "will help" },
        { q: "I ____ (not/go).", opts: ["don't go", "won't go", "won't goes"], a: "won't go" },
        { q: "____ (you/come)?", opts: ["Will you come", "Do you come", "Will you coming"], a: "Will you come" },
        { q: "It ____ (be) fine.", opts: ["will be", "will is", "will to be"], a: "will be" },
        { q: "Wait! I ____ (open) it.", opts: ["will open", "open", "going to open"], a: "will open" },
        { q: "They ____ (not/win).", opts: ["won't win", "not win", "willn't win"], a: "won't win" },
        { q: "What ____ (happen)?", opts: ["will happen", "happen will", "will happens"], a: "will happen" },
        { q: "We ____ (see) you.", opts: ["will see", "see", "will seeing"], a: "will see" },
        { q: "Where ____ (live)?", opts: ["will you live", "you will live", "will live you"], a: "will you live" },
        { q: "I promise I ____ (call).", opts: ["will call", "call", "will calling"], a: "will call" }
    ];
    let qIdx = 0; let score = 0;

    function initQuiz() {
        qIdx = 0; score = 0;
        document.getElementById('quiz-ui').style.display = 'block';
        document.getElementById('quiz-results').style.display = 'none';
        renderQuestion();
    }

    function renderQuestion() {
        if(qIdx >= quizQ.length) return finishQuiz();
        const data = quizQ[qIdx];
        document.getElementById('questionBox').innerText = `${qIdx+1}. ${data.q}`;
        const box = document.getElementById('optionsBox');
        box.innerHTML = '';
        data.opts.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'btn-outline';
            btn.style.marginTop = '10px';
            btn.innerText = opt;
            btn.onclick = () => { if(opt === data.a) score++; qIdx++; renderQuestion(); };
            box.appendChild(btn);
        });
        document.getElementById('quizProgress').style.width = `${(qIdx / quizQ.length) * 100}%`;
    }

    function finishQuiz() {
        document.getElementById('quiz-ui').style.display = 'none';
        document.getElementById('quiz-results').style.display = 'block';
        document.getElementById('finalScore').innerText = `Score: ${score} / ${quizQ.length}`;
        if(score >= 8) confetti();
    }
</script>

</body>
</html>
